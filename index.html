<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Mirror – Ærlig Feedback</title>
  <style>
    body {
      margin: 0;
      display: flex;
      background: #0a0a0a;
      color: white;
      font-family: sans-serif;
    }
    aside {
      width: 200px;
      background: #111;
      padding: 20px;
      height: 100vh;
      position: fixed;
      top: 0;
      left: 0;
    }
    aside h2 {
      font-size: 18px;
      margin-bottom: 20px;
    }
    aside button {
      display: block;
      margin-bottom: 10px;
      width: 100%;
      padding: 10px;
      font-size: 16px;
      background: #222;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }
    .main {
      margin-left: 220px;
      width: calc(100% - 220px);
      padding: 20px;
    }
    textarea, input[type="file"], input[type="text"], input[type="password"], input[type="email"], input[type="search"] {
      width: 90%;
      background: #222;
      color: white;
      border: 1px solid #555;
      border-radius: 8px;
      padding: 10px;
      font-size: 16px;
      margin-top: 10px;
    }
    button.action {
      margin-top: 10px;
      padding: 10px 24px;
      font-size: 16px;
      border: none;
      background: #28a745;
      color: white;
      border-radius: 8px;
      cursor: pointer;
    }
    .box {
      background: #1a1a1a;
      padding: 20px;
      border-radius: 10px;
      margin-top: 20px;
    }
    img.uploaded-img {
      max-width: 300px;
      border-radius: 8px;
    }
    #toast {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: #28a745;
      color: white;
      padding: 10px 20px;
      border-radius: 8px;
      display: none;
      z-index: 1000;
    }
  </style>
</head>
<body>
  <aside>
    <h2>Mirror Menu</h2>
    <button onclick="navigate('publish')">Publish</button>
    <button onclick="navigate('feedback')">Your Feedback</button>
    <button onclick="navigate('liked')">Your Liked</button>
    <button onclick="navigate('settings')">Settings</button>
    <button onclick="logout()">Log out</button>
  </aside>
  <div class="main">
    <div id="toast"></div>
    <div id="authSection">
      <h2>Registrer deg</h2>
      <input type="text" id="regUser" placeholder="Brukernavn">
      <input type="password" id="regPass" placeholder="Passord">
      <input type="email" id="regEmail" placeholder="Gmail">
      <button class="action" onclick="register()">Sign up</button>
      <h3>Eller logg inn</h3>
      <input type="text" id="logUser" placeholder="Brukernavn">
      <input type="password" id="logPass" placeholder="Passord">
      <button class="action" onclick="login()">Log in</button>
    </div>

    <div id="publishSection" style="display:none;">
      <h2>Del idé eller bilde</h2>
      <textarea id="postText" placeholder="Skriv din idé..."></textarea>
      <input type="file" id="postImage" accept="image/*">
      <button class="action" onclick="submitPost()">Post</button>
    </div>

    <div id="feedbackSection" class="box" style="display:none;">
      <h2>Gi ærlig feedback</h2>
      <input type="search" id="searchBox" placeholder="Søk i poster..." oninput="searchPosts()">
      <div id="randomPost"></div>
      <label>Score (1–10):</label>
      <input type="number" id="score" min="1" max="10" value="5">
      <textarea id="feedbackText" placeholder="Hvordan kan det bli bedre?"></textarea>
      <button class="action" onclick="submitFeedback()">Send feedback</button>
    </div>

    <div id="likedSection" class="box" style="display:none;">
      <h2>Dine likes (kommer snart)</h2>
    </div>

    <div id="settingsSection" class="box" style="display:none;">
      <h2>Settings</h2>
      <p>Flere innstillinger kommer!</p>
    </div>
  </div>

  <script>
    let posts = JSON.parse(localStorage.getItem("mirror_posts")) || [];
    let currentUser = localStorage.getItem("mirror_user") || null;
    const bannedWords = ["fuck", "shit", "helvete", "idiot", "hore"];

    function showToast(msg) {
      const toast = document.getElementById("toast");
      toast.innerText = msg;
      toast.style.display = "block";
      setTimeout(() => toast.style.display = "none", 3000);
    }

    function filterText(text) {
      let clean = text;
      bannedWords.forEach(word => {
        const regex = new RegExp(word, 'gi');
        clean = clean.replace(regex, '***');
      });
      return clean;
    }

    function register() {
      const u = document.getElementById("regUser").value;
      const p = document.getElementById("regPass").value;
      const e = document.getElementById("regEmail").value;
      if (!u || !p || !e) return showToast("Fyll inn alt!");
      localStorage.setItem("user_" + u, JSON.stringify({ pass: p, email: e }));
      localStorage.setItem("mirror_user", u);
      location.reload();
    }

    function login() {
      const u = document.getElementById("logUser").value;
      const p = document.getElementById("logPass").value;
      const data = JSON.parse(localStorage.getItem("user_" + u));
      if (!data || data.pass !== p) return showToast("Feil info!");
      localStorage.setItem("mirror_user", u);
      location.reload();
    }

    function logout() {
      localStorage.removeItem("mirror_user");
      location.reload();
    }

    function navigate(section) {
      ["publish", "feedback", "liked", "settings"].forEach(id => {
        document.getElementById(id + "Section").style.display = "none";
      });
      document.getElementById(section + "Section").style.display = "block";
    }

    function submitPost() {
      const text = filterText(document.getElementById("postText").value);
      const imgInput = document.getElementById("postImage");
      const reader = new FileReader();

      reader.onload = function(e) {
        const imgData = imgInput.files.length > 0 ? e.target.result : null;
        const post = { user: currentUser, text, img: imgData, feedback: [] };
        posts.push(post);
        localStorage.setItem("mirror_posts", JSON.stringify(posts));
        showToast("Postet!");
        getRandomPost();
      };

      if (imgInput.files.length > 0) {
        reader.readAsDataURL(imgInput.files[0]);
      } else {
        reader.onload();
      }
    }

    function getRandomPost(filtered = posts) {
      if (filtered.length === 0) return;
      const idx = Math.floor(Math.random() * filtered.length);
      const post = filtered[idx];
      let html = `<blockquote>"${post.text}"</blockquote>`;
      if (post.img) html += `<img src="${post.img}" class="uploaded-img" />`;
      html += `<input type='hidden' id='currentPostIndex' value='${posts.indexOf(post)}'>`;
      document.getElementById("randomPost").innerHTML = html;
    }

    function searchPosts() {
      const term = document.getElementById("searchBox").value.toLowerCase();
      const filtered = posts.filter(p => p.text.toLowerCase().includes(term));
      getRandomPost(filtered);
    }

    function submitFeedback() {
      const index = document.getElementById("currentPostIndex").value;
      const score = document.getElementById("score").value;
      const text = filterText(document.getElementById("feedbackText").value);
      if (!posts[index].feedback) posts[index].feedback = [];
      const alreadyRated = posts[index].feedback.find(f => f.user === currentUser);
      if (alreadyRated) return showToast("Du har allerede vurdert denne posten!");
      posts[index].feedback.push({ user: currentUser, score, text });
      localStorage.setItem("mirror_posts", JSON.stringify(posts));
      showToast("Feedback sendt!");
      getRandomPost();
    }

    if (currentUser) {
      document.getElementById("authSection").style.display = "none";
      navigate("publish");
      getRandomPost();
    }
  </script>
</body>
</html>
