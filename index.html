<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Mirror â€“ Ã†rlig Feedback</title>
  <style>
    body {
      margin: 0;
      background: #0a0a0a;
      color: white;
      font-family: sans-serif;
      text-align: center;
    }
    header {
      padding: 20px;
      background: #111;
      box-shadow: 0 0 10px #000;
    }
    h1 {
      margin: 0;
      font-size: 28px;
    }
    .container {
      padding: 20px;
    }
    textarea, input[type="file"], input[type="text"], input[type="password"], input[type="email"], input[type="search"] {
      width: 90%;
      background: #222;
      color: white;
      border: 1px solid #555;
      border-radius: 8px;
      padding: 10px;
      font-size: 16px;
      margin-top: 10px;
    }
    button {
      margin-top: 10px;
      padding: 10px 24px;
      font-size: 16px;
      border: none;
      background: #28a745;
      color: white;
      border-radius: 8px;
      cursor: pointer;
    }
    .feedback-box, .history-box, .auth-box, .profile-box {
      margin-top: 30px;
      background: #1a1a1a;
      padding: 20px;
      border-radius: 10px;
    }
    input[type=number] {
      width: 60px;
      padding: 6px;
      font-size: 16px;
      border: 1px solid #555;
      border-radius: 5px;
      background: #222;
      color: white;
    }
    footer {
      margin-top: 40px;
    }
    .socials img {
      width: 40px;
      margin: 10px;
      cursor: pointer;
      transition: transform 0.2s ease;
    }
    .socials img:hover {
      transform: scale(1.1);
    }
    img.uploaded-img {
      max-width: 300px;
      margin-top: 10px;
      border-radius: 8px;
    }
    #toast {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: #28a745;
      color: white;
      padding: 10px 20px;
      border-radius: 8px;
      display: none;
    }
  </style>
</head>
<body>
  <header>
    <h1>ðŸªž Mirror â€“ Ã†rlig og anonym feedback</h1>
    <div id="userInfo"></div>
    <button onclick="logout()">Logg ut</button>
  </header>

  <div id="authSection" class="container">
    <div class="auth-box">
      <h2>Registrer deg</h2>
      <input type="text" id="regUser" placeholder="Brukernavn">
      <input type="password" id="regPass" placeholder="Passord">
      <input type="email" id="regEmail" placeholder="Gmail">
      <button onclick="register()">Sign up</button>
      <h3>Eller logg inn</h3>
      <input type="text" id="logUser" placeholder="Brukernavn">
      <input type="password" id="logPass" placeholder="Passord">
      <button onclick="login()">Log in</button>
    </div>
  </div>

  <div id="mainApp" class="container" style="display:none;">
    <h2>1. Del en idÃ©, bilde eller tekst</h2>
    <textarea id="postText" placeholder="Skriv din idÃ©..."></textarea>
    <br>
    <input type="file" id="postImage" accept="image/*">
    <br>
    <button onclick="submitPost()">Post</button>

    <div class="feedback-box">
      <h2>2. Gi Ã¦rlig feedback</h2>
      <input type="search" id="searchBox" placeholder="SÃ¸k i poster..." oninput="searchPosts()">
      <div id="randomPost"></div>
      <label for="score">Score (1â€“10):</label>
      <input type="number" id="score" min="1" max="10" value="5" />
      <br><br>
      <textarea id="feedbackText" placeholder="Hvordan kan det bli bedre?"></textarea>
      <br>
      <button onclick="submitFeedback()">Send feedback</button>
    </div>

    <div class="profile-box">
      <h2>Your Profile</h2>
      <button onclick="renderPostHistory()">Se dine poster og feedback</button>
      <div id="postHistory"></div>
    </div>
  </div>

  <footer>
    <h3>Support our socials</h3>
    <div class="socials">
      <a href="https://www.youtube.com/@TurboTalesnrwy" target="_blank">
        <img src="https://upload.wikimedia.org/wikipedia/commons/b/b8/YouTube_Logo_2017.svg" alt="YouTube" />
      </a>
      <a href="https://www.tiktok.com/@turbotales02" target="_blank">
        <img src="https://upload.wikimedia.org/wikipedia/en/0/0a/TikTok_logo.svg" alt="TikTok" />
      </a>
    </div>
  </footer>

  <div id="toast"></div>

  <script>
    let posts = JSON.parse(localStorage.getItem("mirror_posts")) || [];
    let currentUser = localStorage.getItem("mirror_user") || null;
    const bannedWords = ["fuck", "shit", "helvete", "idiot", "hore"];

    function showToast(msg) {
      const toast = document.getElementById("toast");
      toast.innerText = msg;
      toast.style.display = "block";
      setTimeout(() => toast.style.display = "none", 3000);
    }

    function filterText(text) {
      let clean = text;
      bannedWords.forEach(word => {
        const regex = new RegExp(word, 'gi');
        clean = clean.replace(regex, '***');
      });
      return clean;
    }

    function updateUserInfo() {
      document.getElementById("userInfo").innerText = currentUser ? `Logget inn som ${currentUser}` : "";
    }

    function register() {
      const u = document.getElementById("regUser").value;
      const p = document.getElementById("regPass").value;
      const e = document.getElementById("regEmail").value;
      if (!u || !p || !e) return showToast("Fyll inn alle felt!");
      localStorage.setItem("user_" + u, JSON.stringify({ pass: p, email: e }));
      localStorage.setItem("mirror_user", u);
      location.reload();
    }

    function login() {
      const u = document.getElementById("logUser").value;
      const p = document.getElementById("logPass").value;
      const data = JSON.parse(localStorage.getItem("user_" + u));
      if (!data || data.pass !== p) return showToast("Feil brukernavn/passord");
      localStorage.setItem("mirror_user", u);
      location.reload();
    }

    function logout() {
      localStorage.removeItem("mirror_user");
      location.reload();
    }

    function submitPost() {
      const text = filterText(document.getElementById("postText").value);
      const imgInput = document.getElementById("postImage");
      const reader = new FileReader();

      reader.onload = function(e) {
        const imgData = imgInput.files.length > 0 ? e.target.result : null;
        const post = { user: currentUser, text, img: imgData, feedback: [] };
        posts.push(post);
        localStorage.setItem("mirror_posts", JSON.stringify(posts));
        showToast("Innlegg postet!");
        getRandomPost();
        renderPostHistory();
      };

      if (imgInput.files.length > 0) {
        reader.readAsDataURL(imgInput.files[0]);
      } else {
        reader.onload();
      }
    }

    function getRandomPost(filtered = posts) {
      if (filtered.length === 0) return;
      const idx = Math.floor(Math.random() * filtered.length);
      const post = filtered[idx];
      let html = `<blockquote>"${post.text}"</blockquote>`;
      if (post.img) {
        html += `<img src="${post.img}" class="uploaded-img" />`;
      }
      html += `<input type='hidden' id='currentPostIndex' value='${posts.indexOf(post)}'>`;
      document.getElementById("randomPost").innerHTML = html;
    }

    function searchPosts() {
      const term = document.getElementById("searchBox").value.toLowerCase();
      const filtered = posts.filter(p => p.text.toLowerCase().includes(term));
      getRandomPost(filtered);
    }

    function submitFeedback() {
      const index = document.getElementById("currentPostIndex").value;
      const score = document.getElementById("score").value;
      const text = filterText(document.getElementById("feedbackText").value);
      if (!posts[index].feedback) posts[index].feedback = [];
      posts[index].feedback.push({ user: currentUser, score, text });
      localStorage.setItem("mirror_posts", JSON.stringify(posts));
      showToast("Feedback sendt!");
      getRandomPost();
    }

    function renderPostHistory() {
      let html = "";
      posts.forEach(post => {
        if (post.user === currentUser) {
          html += `<div style='margin-bottom:20px;'>
            <strong>${post.text}</strong><br>`;
          if (post.img) {
            html += `<img src='${post.img}' class='uploaded-img'><br>`;
          }
          if (post.feedback && post.feedback.length > 0) {
            html += `<em>Feedback mottatt:</em><ul>`;
            post.feedback.forEach(f => {
              html += `<li>${f.score}/10 â€“ ${f.text}</li>`;
            });
            html += `</ul>`;
          }
          html += `</div>`;
        }
        post.feedback?.forEach(fb => {
          if (fb.user === currentUser) {
            html += `<div><em>Du ga feedback pÃ¥:</em><br>"${post.text}"<br><strong>${fb.score}/10</strong> â€“ ${fb.text}</div><hr>`;
          }
        });
      });
      document.getElementById("postHistory").innerHTML = html;
    }

    if (currentUser) {
      document.getElementById("authSection").style.display = "none";
      document.getElementById("mainApp").style.display = "block";
      updateUserInfo();
      getRandomPost();
      renderPostHistory();
    }
  </script>
</body>
</html>
